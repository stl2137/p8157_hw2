---
title: 'P8157 HW #2'
author: "Sabrina Lin stl2137"
date: "10/8/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(gee)
library(geepack)
```

# Question 1 

* The binary onycholysis outcome variable Y is coded 0 = none or mild, 1 = moderate or severe. 

* The categorical variable Treatment is coded 1=oral treatment A, 0=oral treatment B. 

* The variable Month denotes the exact timing of measurements in months. The variable Visit denotes the visit number (visit numbers 1-7 correspond to scheduled visits at 0, 4, 8, 12, 24, 36, and 48 weeks).

```{r}
### Import data

toenail_dat <- read.delim("/Users/SabrinaLin/Documents/Fall_2020_Longitudinal/HW2/toenail.txt", header = TRUE, sep = "", col.names = c("ID", "Y", "Treatment", "Month", "Visit")) %>% 
  janitor::clean_names() %>% 
  mutate(
    treatment = as.factor(treatment)
  )
```

## Part 1

Consider a marginal model for the log odds of moderate or severe onycholysis. Using GEE, set up a suitable model assuming linear trends. Use month as the time variable. Assume “exchangeable” correlation for the association among the repeated binary responses.

```{r}
marginal_toenail_mod <- geeglm(y ~ treatment + month, data = toenail_dat, family = "binomial" (link = "logit"), id = id, corstr = "exchangeable")

summary(marginal_toenail_mod)
```

## Part 2 

Provide Interpretations for the coefficients in your model.

* 0.04020 is the log odds ratio between treatment A and treatment B of having moderate or severe onycholysis for every month in the study, holding all other variables constant. 

_-0.20505 is the log odds ratio of having moderate or severe onycholysis versus mild or no onycholysis for every month in the study, holding all other variables constant. 

## Part 3 (no idea if this makes sense)

From the results of your analysis what conclusions do you draw about the effect of treatment on changes in the severity of onycholysis over time? Provide results that support your conclusions.

* Based off the results of the model, treatment A compared to treatment B increases the probability of developing moderate or severe onycholysis when time is held constant. When treatment is held constant, time will decrease the probability of developing moderate or sever onycholysis. Since the absolute value for the coefficient of month is greater than the absolute value for the coefficient of treatment A compared to treatment B, the probability of developing severity of onycholysis over time will decrease. 

## Part 4

Try Different correlation structures. Is the analysis and inference sensitive to this choice?

```{r}
### AR(1) correlation structure
ar1_toenail_mod <- geeglm(y ~ treatment + month, data = toenail_dat, family = "binomial" (link = "logit"), id = id, corstr = "ar1")

summary(ar1_toenail_mod)

### Unstructured correlation structure
unstructured_toenail_mod <- geeglm(y ~ treatment + month, data = toenail_dat, family = "binomial" (link = "logit"), id = id, corstr = "unstructured")

summary(unstructured_toenail_mod)
```

# Question 2

* The outcome variable Y is a count of the of the number of new skin cancers per year. 

*The categorical variable Treatment is coded 1=beta carotene, 0 =placebo. 

*The variable Year denotes the year of follow-up. 

*The categorical variable Gender is coded 1 male, 0 female. 

*The categorical variable Skin denotes skin type and is coded 1 = burns, 0 otherwise. 

*The variable Exposure is a count of the number of previous skin cancers. 

*The variable Age is the age (in years) of each subject at randomization.

```{r}
skin_dat <- read.delim("/Users/SabrinaLin/Documents/Fall_2020_Longitudinal/HW2/skin.txt", header = TRUE, sep = "", col.names = c("ID", "Center", "Age", "Skin", "Gender", "Exposure", "Y", "Treatment", "Year")) %>% 
  janitor::clean_names() %>% 
  mutate(
    treatment = as.factor(treatment),
    gender = as.factor(gender),
    skin = as.factor(skin)
  )
```

## Part 1
Set up a suitable GEE model for rate of skin cancers with Treatment and Year as covariates.

```{r}
skin_geeglm_mod <- geeglm(y ~ treatment + year, data = skin_dat, family = "poisson", id = id, corstr = "unstructured")

summary(skin_geeglm_mod)
```

## Part 2
Provide Interpretations for the coefficients in your model.

```{r}

```

## Part 3
From the results of your analysis what conclusions do you draw about the effect of beta carotene on the rate of skin cancers? Provide results that support your conclusions.

```{r}

```

## Part 4
Repeat the above analysis adjusting for skin type, age, and the count of the number of previous skin cancers. What conclusions do you draw about the effect of beta carotene on the adjusted rate of skin cancers?

```{r}

```

